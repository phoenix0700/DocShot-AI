{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS",
    "buildCommand": "cd ../.. && pnpm install && pnpm build --filter=worker",
    "watchPatterns": [
      "apps/worker/**",
      "packages/**"
    ]
  },
  "deploy": {
    "runtime": "NODE",
    "startCommand": "cd apps/worker && npm start",
    "numReplicas": 1,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  },
  "envVars": {
    "NODE_ENV": {
      "value": "production"
    },
    "REDIS_URL": {
      "fromService": "redis"
    },
    "SUPABASE_URL": {
      "value": "${{SUPABASE_URL}}"
    },
    "SUPABASE_SERVICE_KEY": {
      "value": "${{SUPABASE_SERVICE_KEY}}"
    },
    "S3_BUCKET": {
      "value": "${{S3_BUCKET}}"
    },
    "S3_ACCESS_KEY": {
      "value": "${{S3_ACCESS_KEY}}"
    },
    "S3_SECRET_KEY": {
      "value": "${{S3_SECRET_KEY}}"
    },
    "S3_ENDPOINT": {
      "value": "${{S3_ENDPOINT}}"
    },
    "GITHUB_TOKEN": {
      "value": "${{GITHUB_TOKEN}}"
    },
    "SMTP_HOST": {
      "value": "${{SMTP_HOST}}"
    },
    "SMTP_PORT": {
      "value": "${{SMTP_PORT}}"
    },
    "SMTP_USER": {
      "value": "${{SMTP_USER}}"
    },
    "SMTP_PASS": {
      "value": "${{SMTP_PASS}}"
    }
  }
}